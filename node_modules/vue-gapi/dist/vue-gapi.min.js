/*!
 * vue-gapi v0.1.0
 * (c) 2019 CedricPoilly
 * Released under the MIT License.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.VueGapi=e.VueGapi||{})}(this,function(e){"use strict";var n,a=(n="https://apis.google.com/js/api.js",new Promise(function(t,e){var i=document.createElement("script");i.src=n,i.onreadystatechange=i.onload=function(){var e=setInterval(function(){i.readyState&&!/loaded|complete/.test(i.readyState)||(clearInterval(e),console.log("gapi.js loaded."),t())},100)},document.getElementsByTagName("head")[0].appendChild(i)})),t=function(){this.authenticated=this.isAuthenticated(),this.authInstance=null,this.offlineAccessCode=null,this.getOfflineAccessCode=this.getOfflineAccessCode.bind(this),this.grantOfflineAccess=this.grantOfflineAccess.bind(this),this.login=this.login.bind(this),this.refreshToken=this.refreshToken.bind(this),this.logout=this.logout.bind(this),this.isAuthenticated=this.isAuthenticated.bind(this),this.isSignedIn=this.isSignedIn.bind(this),this.listenUserSignIn=this.listenUserSignIn.bind(this)};t.prototype._expiresAt=function(e){return JSON.stringify(1e3*e.expires_in+(new Date).getTime())},t.prototype._setStorage=function(e,t){void 0===t&&(t=null),localStorage.setItem("gapi.access_token",e.access_token),localStorage.setItem("gapi.id_token",e.id_token),localStorage.setItem("gapi.expires_at",this._expiresAt(e)),t&&(localStorage.setItem("gapi.id",t.getId()),localStorage.setItem("gapi.full_name",t.getName()),localStorage.setItem("gapi.first_name",t.getGivenName()),localStorage.setItem("gapi.last_name",t.getFamilyName()),localStorage.setItem("gapi.image_url",t.getImageUrl()),localStorage.setItem("gapi.email",t.getEmail()))},t.prototype._clearStorage=function(){localStorage.removeItem("gapi.access_token"),localStorage.removeItem("gapi.id_token"),localStorage.removeItem("gapi.expires_at"),localStorage.removeItem("gapi.id"),localStorage.removeItem("gapi.full_name"),localStorage.removeItem("gapi.first_name"),localStorage.removeItem("gapi.last_name"),localStorage.removeItem("gapi.image_url"),localStorage.removeItem("gapi.email")},t.prototype._setOfflineAccessCode=function(e){if(!e.code)throw new Error("Offline access code missing from result",e);this.offlineAccessCode=e.code},t.prototype._setSession=function(e){var t=this.authInstance.currentUser.get().getBasicProfile(),i=e.Zi;this._setStorage(i,t),this.authenticated=!0},t.prototype.getOfflineAccessCode=function(){return this.offlineAccessCode},t.prototype.grantOfflineAccess=function(e){if(!this.authInstance)throw new Error("gapi not initialized");return this.authInstance.grantOfflineAccess().then(this._setOfflineAccessCode.bind(this))},t.prototype.login=function(e){if(!this.authInstance)throw new Error("gapi not initialized");var i=this;return new Promise(function(t,e){i.authInstance.signIn().then(function(e){i._setSession(e),t()})})},t.prototype.refreshToken=function(e){var t=this;if(!this.authInstance)throw new Error("gapi not initialized");this.authInstance.currentUser.get().reloadAuthResponse().then(function(e){t._setStorage(e)})},t.prototype.logout=function(e){if(!this.authInstance)throw new Error("gapi not initialized");var i=this;return new Promise(function(e,t){i.authInstance.signOut().then(function(){i._clearStorage(),i.authenticated=!1,e()})})},t.prototype.isAuthenticated=function(){var e=JSON.parse(localStorage.getItem("gapi.expires_at"));return(new Date).getTime()<e},t.prototype.isSignedIn=function(){if(!this.authInstance)throw new Error("gapi not initialized");return this.authInstance.currentUser.get().isSignedIn()},t.prototype.listenUserSignIn=function(e){if(!this.authInstance)throw new Error("gapi not initialized");return this.authInstance.isSignedIn.listen(e),!!this.authInstance.currentUser.get().isSignedIn()&&this.getUserData()},t.prototype.getUserData=function(){return{id:localStorage.getItem("gapi.id"),firstName:localStorage.getItem("gapi.first_name"),lastName:localStorage.getItem("gapi.last_name"),fullName:localStorage.getItem("gapi.full_name"),email:localStorage.getItem("gapi.email"),imageUrl:localStorage.getItem("gapi.image_url"),expiresAt:localStorage.getItem("gapi.expires_at"),accessToken:localStorage.getItem("gapi.access_token"),idToken:localStorage.getItem("gapi.id_token")}};var r=new t,i=r.grantOfflineAccess,s=r.getOfflineAccessCode,g=r.login,c=r.logout,l=r.isAuthenticated,p=r.getUserData,u=r.refreshToken,f=r.isSignedIn,h=r.listenUserSignIn,o={install:function(n,o){n.gapiLoadClientPromise=null;n.prototype.$gapi={getGapiClient:function(){return new Promise(function(e,t){if(n.gapiLoadClientPromise&&0===n.gapiLoadClientPromise.status)return e(window.gapi);var i;i=e,a.then(function(e){var t=window.gapi;t?t.auth?i(t):t.load("client:auth2",function(){n.gapiLoadClientPromise=t.client.init(o).then(function(){console.info("gapi client initialised."),r.authInstance=t.auth2.getAuthInstance(),n.gapiLoadClientPromise.status=0,i(t)}).catch(function(e){if(e.error){var t=e.error;console.error("Failed to initialize gapi: %s (status=%s, code=%s)",t.message,t.status,t.code,e)}})}):console.error("Failed to load gapi!")})})},getOfflineAccessCode:s,grantOfflineAccess:function(){return n.prototype.$gapi.getGapiClient().then(i)},login:function(e){return n.prototype.$gapi.getGapiClient().then(function(){g().then(function(){e()})})},refreshToken:function(){return n.prototype.$gapi.getGapiClient().then(u)},logout:function(e){return n.prototype.$gapi.getGapiClient().then(function(){c().then(function(){e()})})},listenUserSignIn:function(e){return n.prototype.$gapi.getGapiClient().then(function(){return h(e)})},isSignedIn:function(){return n.prototype.$gapi.getGapiClient().then(f)},isAuthenticated:l,getUserData:p},n.prototype.isGapiLoaded=function(){return n.gapiLoadClientPromise&&0===n.gapiLoadClientPromise.status};var e=function(e,t){return"The "+e+" Vue instance method is deprecated and will be removed in a future release. Please use "+t+" instead."};n.prototype.$getGapiClient=function(){return console.warn(e("$getGapiClient","$gapi.getGapiClient")),n.prototype.$gapi.getGapiClient()},n.prototype.$login=function(){return console.warn(e("$login","$gapi.login")),n.prototype.$gapi.login()},n.prototype.$refreshToken=function(){return console.warn(e("$refreshToken","$gapi.refreshToken")),n.prototype.$gapi.refreshToken()},n.prototype.$logout=function(){return console.warn(e("$logout","$gapi.logout")),n.prototype.$gapi.logout()},n.prototype.$isAuthenticated=function(){return console.warn(e("$isAuthenticated","$gapi.isAuthenticated")),n.prototype.$gapi.isAuthenticated()},n.prototype.$isSignedIn=function(){return console.warn(e("$isAuthenticated","$gapi.isAuthenticated")),n.prototype.$gapi.isSignedIn()},n.prototype.$getUserData=function(){return console.warn(e("$getUserData","$gapi.getUserData")),n.prototype.$gapi.getUserData()}}};function d(e,t){e.use(o,t)}"undefined"!=typeof window&&window.Vue&&window.Vue.use(d);e.default=d,e.version="0.1.0",Object.defineProperty(e,"__esModule",{value:!0})});